require "rexml/document"
source = "<VM><ID>817</ID><UID>0</UID><GID>0</GID><UNAME>oneadmin</UNAME><GNAME>oneadmin</GNAME><NAME>test-hooks-vj</NAME><PERMISSIONS><OWNER_U>1</OWNER_U><OWNER_M>1</OWNER_M><OWNER_A>0</OWNER_A><GROUP_U>0</GROUP_U><GROUP_M>0</GROUP_M><GROUP_A>0</GROUP_A><OTHER_U>0</OTHER_U><OTHER_M>0</OTHER_M><OTHER_A>0</OTHER_A></PERMISSIONS><LAST_POLL>1475217268</LAST_POLL><STATE>3</STATE><LCM_STATE>18</LCM_STATE><PREV_STATE>3</PREV_STATE><PREV_LCM_STATE>3</PREV_LCM_STATE><RESCHED>0</RESCHED><STIME>1475214108</STIME><ETIME>0</ETIME><DEPLOY_ID>one-817</DEPLOY_ID><MONITORING><CPU><![CDATA[1.0]]></CPU><MEMORY><![CDATA[1048576]]></MEMORY><NETRX><![CDATA[34388]]></NETRX><NETTX><![CDATA[15413]]></NETTX></MONITORING><TEMPLATE><AUTOMATIC_DS_REQUIREMENTS><![CDATA[\"CLUSTERS/ID\" @> 0 | \"CLUSTERS/ID\" @> 100]]></AUTOMATIC_DS_REQUIREMENTS><AUTOMATIC_REQUIREMENTS><![CDATA[(CLUSTER_ID = 0 | CLUSTER_ID = 100) & !(PUBLIC_CLOUD = YES)]]></AUTOMATIC_REQUIREMENTS><CONTEXT><DISK_ID><![CDATA[1]]></DISK_ID><ETH0_CONTEXT_FORCE_IPV4><![CDATA[]]></ETH0_CONTEXT_FORCE_IPV4><ETH0_DNS><![CDATA[8.8.8.8 8.8.4.4]]></ETH0_DNS><ETH0_GATEWAY><![CDATA[198.168.0.1]]></ETH0_GATEWAY><ETH0_GATEWAY6><![CDATA[]]></ETH0_GATEWAY6><ETH0_IP><![CDATA[192.168.0.125]]></ETH0_IP><ETH0_IP6><![CDATA[]]></ETH0_IP6><ETH0_IP6_ULA><![CDATA[]]></ETH0_IP6_ULA><ETH0_MAC><![CDATA[02:00:c0:a8:00:7d]]></ETH0_MAC><ETH0_MASK><![CDATA[255.255.255.0]]></ETH0_MASK><ETH0_MTU><![CDATA[]]></ETH0_MTU><ETH0_NETWORK><![CDATA[]]></ETH0_NETWORK><ETH0_SEARCH_DOMAIN><![CDATA[]]></ETH0_SEARCH_DOMAIN><ETH0_VLAN_ID><![CDATA[]]></ETH0_VLAN_ID><ETH0_VROUTER_IP><![CDATA[]]></ETH0_VROUTER_IP><ETH0_VROUTER_IP6><![CDATA[]]></ETH0_VROUTER_IP6><ETH0_VROUTER_MANAGEMENT><![CDATA[]]></ETH0_VROUTER_MANAGEMENT><FILES><![CDATA[/megam/init.sh]]></FILES><NETWORK><![CDATA[YES]]></NETWORK><NODE_NAME><![CDATA[test-hooks-vj]]></NODE_NAME><SET_HOSTNAME><![CDATA[test-hooks-vj]]></SET_HOSTNAME><SSH_PUBLIC_KEY><![CDATA[ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1jQliF7Nl3tQ6fPcbSy4MD8bsmDrYkkhxND3jI26ckNxapdiq7ujeU9bFS8ttZB495F9fMHiY0s344FqKLtyTOVogmUesT3ysO2h87iTDN3bkcXL6I3bE5oxlRtlSt9QNygzBR9B7BMerYRkQqTQZwxTu+ETb9Nu+5pBKRXlDHSNssFuhD/8t4ZpLzws+vSYMxpFWnTyIAqZ33oZUl8MK+j5gP77+WRgBByAqztjDO+gP4Wq2Qmj/IIG1L4/z3ZTq2wAkahNIykH8PgKEpLzYL8XSEPo09JAXw+UpEWPyzyway/f35zaNkV15naUBfwQMXhWYL0UjJ7ol7FOn8tR7 oneadmin@megammaster]]></SSH_PUBLIC_KEY><TARGET><![CDATA[hdb]]></TARGET></CONTEXT><CPU><![CDATA[0.5]]></CPU><CPU_COST><![CDATA[5]]></CPU_COST><DISK><CEPH_HOST><![CDATA[megamadhi]]></CEPH_HOST><CEPH_SECRET><![CDATA[2053eb31-5ed4-4f76-8539-9baddbdbc0e1]]></CEPH_SECRET><CEPH_USER><![CDATA[libvirt]]></CEPH_USER><CLONE><![CDATA[YES]]></CLONE><CLONE_TARGET><![CDATA[SELF]]></CLONE_TARGET><CLUSTER_ID><![CDATA[0,100]]></CLUSTER_ID><DATASTORE><![CDATA[cephds]]></DATASTORE><DATASTORE_ID><![CDATA[100]]></DATASTORE_ID><DEV_PREFIX><![CDATA[hd]]></DEV_PREFIX><DISK_ID><![CDATA[0]]></DISK_ID><DISK_SNAPSHOT_TOTAL_SIZE><![CDATA[0]]></DISK_SNAPSHOT_TOTAL_SIZE><DISK_TYPE><![CDATA[RBD]]></DISK_TYPE><DRIVER><![CDATA[raw]]></DRIVER><IMAGE><![CDATA[ubuntu_14.04]]></IMAGE><IMAGE_ID><![CDATA[94]]></IMAGE_ID><IMAGE_STATE><![CDATA[2]]></IMAGE_STATE><IMAGE_UNAME><![CDATA[oneadmin]]></IMAGE_UNAME><LN_TARGET><![CDATA[NONE]]></LN_TARGET><POOL_NAME><![CDATA[one]]></POOL_NAME><READONLY><![CDATA[NO]]></READONLY><SAVE><![CDATA[NO]]></SAVE><SIZE><![CDATA[10240]]></SIZE><SOURCE><![CDATA[one/one-94]]></SOURCE><TARGET><![CDATA[hda]]></TARGET><TM_MAD><![CDATA[ceph]]></TM_MAD><TYPE><![CDATA[RBD]]></TYPE></DISK><GRAPHICS><LISTEN><![CDATA[0.0.0.0]]></LISTEN><PORT><![CDATA[6717]]></PORT><TYPE><![CDATA[VNC]]></TYPE></GRAPHICS><MEMORY><![CDATA[1024]]></MEMORY><MEMORY_COST><![CDATA[10]]></MEMORY_COST><NIC><AR_ID><![CDATA[0]]></AR_ID><BRIDGE><![CDATA[one]]></BRIDGE><CLUSTER_ID><![CDATA[0,100]]></CLUSTER_ID><IP><![CDATA[192.168.0.125]]></IP><MAC><![CDATA[02:00:c0:a8:00:7d]]></MAC><NETWORK><![CDATA[ipv4-pri]]></NETWORK><NETWORK_ID><![CDATA[0]]></NETWORK_ID><NIC_ID><![CDATA[0]]></NIC_ID><PHYDEV><![CDATA[enp9s0f0]]></PHYDEV><SECURITY_GROUPS><![CDATA[0]]></SECURITY_GROUPS><TARGET><![CDATA[one-817-0]]></TARGET><VN_MAD><![CDATA[dummy]]></VN_MAD></NIC><OS><ARCH><![CDATA[x86_64]]></ARCH></OS><SECURITY_GROUP_RULE><PROTOCOL><![CDATA[ALL]]></PROTOCOL><RULE_TYPE><![CDATA[OUTBOUND]]></RULE_TYPE><SECURITY_GROUP_ID><![CDATA[0]]></SECURITY_GROUP_ID><SECURITY_GROUP_NAME><![CDATA[default]]></SECURITY_GROUP_NAME></SECURITY_GROUP_RULE><SECURITY_GROUP_RULE><PROTOCOL><![CDATA[ALL]]></PROTOCOL><RULE_TYPE><![CDATA[INBOUND]]></RULE_TYPE><SECURITY_GROUP_ID><![CDATA[0]]></SECURITY_GROUP_ID><SECURITY_GROUP_NAME><![CDATA[default]]></SECURITY_GROUP_NAME></SECURITY_GROUP_RULE><TEMPLATE_ID><![CDATA[0]]></TEMPLATE_ID><VCPU><![CDATA[1]]></VCPU><VMID><![CDATA[817]]></VMID></TEMPLATE><USER_TEMPLATE><DESCRIPTION><![CDATA[test megam image]]></DESCRIPTION><SCHED_REQUIREMENTS><![CDATA[CLUSTER_ID=\"100\"]]></SCHED_REQUIREMENTS></USER_TEMPLATE><HISTORY_RECORDS><HISTORY><OID>817</OID><SEQ>4</SEQ><HOSTNAME>192.168.0.115</HOSTNAME><HID>0</HID><CID>100</CID><STIME>1475216532</STIME><ETIME>0</ETIME><VM_MAD><![CDATA[kvm]]></VM_MAD><TM_MAD><![CDATA[ssh]]></TM_MAD><DS_ID>0</DS_ID><PSTIME>0</PSTIME><PETIME>0</PETIME><RSTIME>1475216532</RSTIME><RETIME>0</RETIME><ESTIME>0</ESTIME><EETIME>0</EETIME><REASON>0</REASON><ACTION>0</ACTION></HISTORY></HISTORY_RECORDS></VM>"

doc = REXML::Document.new(source)
formatter = REXML::Formatters::Pretty.new

# Compact uses as little whitespace as possible
formatter.compact = true
formatter.write(doc, $stdout)
#puts doc
