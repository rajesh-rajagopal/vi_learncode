CONTEXT=[FILES="/megam/init.sh",NETWORK="YES",NODE_NAME="$NAME",SET_HOSTNAME="$NAME",SSH_PUBLIC_KEY="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1jQliF7Nl3tQ6fPcbSy4MD8bsmDrYkkhxND3jI26ckNxapdiq7ujeU9bFS8ttZB495F9fMHiY0s344FqKLtyTOVogmUesT3ysO2h87iTDN3bkcXL6I3bE5oxlRtlSt9QNygzBR9B7BMerYRkQqTQZwxTu+ETb9Nu+5pBKRXlDHSNssFuhD/8t4ZpLzws+vSYMxpFWnTyIAqZ33oZUl8MK+j5gP77+WRgBByAqztjDO+gP4Wq2Qmj/IIG1L4/z3ZTq2wAkahNIykH8PgKEpLzYL8XSEPo09JAXw+UpEWPyzyway/f35zaNkV15naUBfwQMXhWYL0UjJ7ol7FOn8tR7 oneadmin@megammaster"]
CPU="1"
CPU_COST="5"
DESCRIPTION="test trusty image"
DISK=[IMAGE="megam",IMAGE_UNAME="oneadmin"]
GRAPHICS=[LISTEN="0.0.0.0",TYPE="VNC"]
MEMORY="1024"
MEMORY_COST="10"
NIC=[NETWORK="open-vs",NETWORK_UNAME="oneadmin"]
OS=[ARCH="x86_64"]
SUNSTONE_CAPACITY_SELECT="YES"
SUNSTONE_NETWORK_SELECT="YES"
VCPU="2"
NAME="megam"

========================

CONTEXT=[FILES="/megam/init.sh",NETWORK="YES",NODE_NAME="$NAME",SET_HOSTNAME="$NAME",SSH_PUBLIC_KEY="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1jQliF7Nl3tQ6fPcbSy4MD8bsmDrYkkhxND3jI26ckNxapdiq7ujeU9bFS8ttZB495F9fMHiY0s344FqKLtyTOVogmUesT3ysO2h87iTDN3bkcXL6I3bE5oxlRtlSt9QNygzBR9B7BMerYRkQqTQZwxTu+ETb9Nu+5pBKRXlDHSNssFuhD/8t4ZpLzws+vSYMxpFWnTyIAqZ33oZUl8MK+j5gP77+WRgBByAqztjDO+gP4Wq2Qmj/IIG1L4/z3ZTq2wAkahNIykH8PgKEpLzYL8XSEPo09JAXw+UpEWPyzyway/f35zaNkV15naUBfwQMXhWYL0UjJ7ol7FOn8tR7 oneadmin@megammaster"]
CPU="1"
CPU_COST="5"
DESCRIPTION="common template images"
DISK=[IMAGE="megam",IMAGE_UNAME="oneadmin"]
GRAPHICS=[LISTEN="0.0.0.0",TYPE="VNC"]
MEMORY="1024"
MEMORY_COST="10"
NIC=[NETWORK="ipv4-pub",NETWORK_UNAME="oneadmin"]
OS=[ARCH="x86_64"]
SUNSTONE_CAPACITY_SELECT="YES"
SUNSTONE_NETWORK_SELECT="YES"
VCPU="2"
NAME="megam"




DESCRIPTION	test debian jessie image	   
SAVED_TEMPLATE_ID	1	   
SCHED_DS_REQUIREMENTS	CLUSTER_ID="101"	   
SCHED_MESSAGE	Thu Jun 16 12:10:30 2016 : No host meets capacity and SCHED_REQUIREMENTS: CLUSTER_ID = 100 & !(PUBLIC_CLOUD = YES) & ( CLUSTER_ID="101" )	   
SCHED_REQUIREMENTS	CLUSTER_ID="101"	   


Add



CONTEXT=[FILES="/megam/init.sh",NETWORK="YES",NODE_NAME="$NAME",SET_HOSTNAME="$NAME",SSH_PUBLIC_KEY="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1jQliF7Nl3tQ6fPcbSy4MD8bsmDrYkkhxND3jI26ckNxapdiq7ujeU9bFS8ttZB495F9fMHiY0s344FqKLtyTOVogmUesT3ysO2h87iTDN3bkcXL6I3bE5oxlRtlSt9QNygzBR9B7BMerYRkQqTQZwxTu+ETb9Nu+5pBKRXlDHSNssFuhD/8t4ZpLzws+vSYMxpFWnTyIAqZ33oZUl8MK+j5gP77+WRgBByAqztjDO+gP4Wq2Qmj/IIG1L4/z3ZTq2wAkahNIykH8PgKEpLzYL8XSEPo09JAXw+UpEWPyzyway/f35zaNkV15naUBfwQMXhWYL0UjJ7ol7FOn8tR7 oneadmin@megammaster"]
CPU="0.5"
CPU_COST="5"
DESCRIPTION="test debian jessie image"
DISK=[IMAGE="Ubuntu-16.04",IMAGE_UNAME="oneadmin"]
GRAPHICS=[LISTEN="0.0.0.0",TYPE="VNC"]
MEMORY="1024"
MEMORY_COST="10"
NIC=[NETWORK="136.243.49.217",NETWORK_UNAME="oneadmin"]
OS=[ARCH="x86_64"]
SCHED_DS_REQUIREMENTS="CLUSTER_ID=\"100\""
SCHED_REQUIREMENTS="CLUSTER_ID=\"100\""
VCPU="1"


CONTEXT=[FILES="/megam/init.sh",NETWORK="YES",NODE_NAME="$NAME",SET_HOSTNAME="$NAME",SSH_PUBLIC_KEY="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1jQliF7Nl3tQ6fPcbSy4MD8bsmDrYkkhxND3jI26ckNxapdiq7ujeU9bFS8ttZB495F9fMHiY0s344FqKLtyTOVogmUesT3ysO2h87iTDN3bkcXL6I3bE5oxlRtlSt9QNygzBR9B7BMerYRkQqTQZwxTu+ETb9Nu+5pBKRXlDHSNssFuhD/8t4ZpLzws+vSYMxpFWnTyIAqZ33oZUl8MK+j5gP77+WRgBByAqztjDO+gP4Wq2Qmj/IIG1L4/z3ZTq2wAkahNIykH8PgKEpLzYL8XSEPo09JAXw+UpEWPyzyway/f35zaNkV15naUBfwQMXhWYL0UjJ7ol7FOn8tR7 oneadmin@megammaster"]
CPU="0.5"
CPU_COST="5"
DESCRIPTION="test debian jessie image"
DISK=[IMAGE="Ubuntu-16.04",IMAGE_UNAME="oneadmin"]
GRAPHICS=[LISTEN="0.0.0.0",TYPE="VNC"]
MEMORY="1024"
MEMORY_COST="10"
NIC=[NETWORK="138.201.21.215",NETWORK_UNAME="oneadmin"]
OS=[ARCH="x86_64"]
SCHED_DS_REQUIREMENTS="CLUSTER_ID=\"101\""
SCHED_REQUIREMENTS="CLUSTER_ID=\"101\""
VCPU="1"



#!/bin/bash
#root@megammaster:/megam# cat init.sh
#stop megamgulpd
#mkdir /$NODE_NAME
#mkdir /$ASSEMBLY_ID

cat > //usr/share/megam/megamgulpd/conf/gulpd.conf << 'EOF'

### Welcome to the Gulpd configuration file.

  ###
  ### [meta]
  ###
  ### Controls the parameters for the Raft consensus group that stores metadata
  ### about the gulp.
  ###

  [meta]
    debug = true
    hostname = "localhost"
    bind_address = ":7777"
    dir = "/var/lib/megam/gulp/meta"
    riak = ["192.168.1.105:8087"]
    api  = "https://api.megam.io/v2"
    amqp = "amqp://guest:guest@192.168.1.105:5672/"

  ###
  ### [gulpd]
  ###
  ### Controls which assembly to be deployed into machine
  ###

  [gulpd]
    enabled = true
    name_gulp = "hostname"
    cats_id = "AMS1259077729232486400"
    cat_id = "ASM1260230009767985152"
	provider = "chefsolo"
	cookbook = "megam_run"
	repository = "github"
	repository_path = "https://github.com/megamsys/chef-repo.git"
        repository_tar_path = "https://github.com/megamsys/chef-repo/archive/0.91.tar.gz"

  ###
  ### [http]
  ###
  ### Controls how the HTTP endpoints are configured. This a frill
  ### mechanism for pinging gulpd (ping)
  ###

  [http]
    enabled = true
    bind-address = "localhost:6666"

EOF

sed -i "s/^[ \t]*name_gulp.*/    name = \"$NODE_NAME\"/" /usr/share/megam/megamgulpd/conf/gulpd.conf
sed -i "s/^[ \t]*cats_id.*/    cats_id = \"$ASSEMBLIES_ID\"/" /usr/share/megam/megamgulpd/conf/gulpd.conf
sed -i "s/^[ \t]*cat_id.*/    cat_id = \"$ASSEMBLY_ID\"/" /usr/share/megam/megamgulpd/conf/gulpd.conf



stop megamgulpd
start megamgulpd

sudo echo 3 > /proc/sys/vm/drop_caches
